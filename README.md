# 智能语音交互虚拟助手系统

## 项目概述

这是一个基于Three.js和VRM模型的交互式虚拟助手系统，集成了语音识别、语音合成、虚拟形象动画、PLC设备控制、后台任务管理和系统配置功能。系统提供了完整的语音交互体验，通过唤醒词触发对话，支持多种动画效果，并具备完善的工业设备管理能力。

## 核心功能

### 1. 语音交互系统
- **语音识别**: 支持中文（简体/繁体）、英语、日语、韩语等多种语言
- **唤醒词检测**: 支持"小竹小竹"等8种唤醒词变体，采用模糊匹配算法
- **语音合成**: 支持多种语音、语速、音调和音量调节
- **连续监听**: 后台持续监听语音输入，唤醒词触发后进入交互模式
- **智能对话**: 与后端AI服务对接，处理用户问题并提供语音回答

### 2. 3D虚拟形象
- **VRM模型加载**: 基于Three.js和three-vrm加载3D虚拟形象
- **动画系统**: 支持站立、回答、挥手等多种动画
- **口型同步**: 根据语音内容自动调整虚拟形象口型
- **表情管理**: 支持眨眼、放松等多种表情
- **自然动作**: 模拟人类说话时的自然身体动作和手势

### 3. PLC设备管理
- **PLC连接配置**: 支持西门子PLC等工业设备连接
- **点位管理**: 完整的点位增删改查、批量导入导出功能
- **实时读写**: 支持PLC点位值的实时读取和写入
- **配置验证**: 自动验证PLC配置的有效性
- **批量操作**: 支持点位批量保存、执行和验证

### 4. 后台任务管理
- **定时读取**: 可按设定间隔自动读取PLC点位值
- **任务调度**: 支持任务启停、启用禁用控制
- **状态监控**: 实时显示任务运行状态和配置信息
- **日志记录**: 完整的任务执行日志记录和查看
- **PLC同步**: 与PLC配置自动同步，确保一致性

### 5. 系统配置管理
- **接口配置**: 后端API接口地址和参数配置
- **语音配置**: 语音识别和合成参数配置
- **PLC配置**: PLC连接参数和点位配置
- **任务配置**: 后台任务相关配置
- **配置持久化**: 支持本地存储和恢复配置

### 6. 多媒体功能
- **背景视频**: 支持背景视频播放，可调节透明度、亮度、对比度等参数
- **电影字幕**: 底部滚动显示系统信息和提示
- **视觉特效**: 左侧特效面板显示系统通知和状态更新
- **音频处理**: 基于WebRTC的音频采集和分析

## 技术架构

### 前端技术栈
- **Three.js**: 3D图形渲染和VRM模型加载
- **Web Speech API**: 语音识别和合成
- **WebRTC**: 音频流媒体处理
- **Fetch API**: 与后端服务通信
- **LocalStorage**: 本地配置存储
- **CSS3**: 现代化UI设计和动画效果

### 后端集成
- **RESTful API**: 标准的HTTP接口设计
- **JSON数据格式**: 统一的数据交换格式
- **状态码管理**: 统一的成功/错误状态码
- **错误处理**: 完善的错误处理和用户提示

### 安全特性
- **管理员认证**: 基于账号密码的管理员登录
- **权限控制**: 配置管理需要管理员权限
- **凭据存储**: 支持记住登录凭据（可选）
- **跨域安全**: 完善的CORS策略和请求验证

## 系统组件

### 1. 语音面板 (Voice Panel)
- 右侧33%宽度的蓝色主题面板
- 显示语音识别和回答结果
- 提供语音助手控制按钮
- 实时显示对话历史

### 2. 特效面板 (Effects Panel)
- 左侧33%宽度的蓝色主题面板
- 显示系统通知和状态更新
- 提供系统操作反馈

### 3. 电影字幕 (Movie Subtitle)
- 底部居中滚动字幕
- 显示系统信息和欢迎语
- 蓝色发光特效文字

### 4. 背景控制 (Background Controls)
- 右上角可折叠控制面板
- 视频透明度、亮度、对比度调节
- 播放速度控制
- 重置功能

### 5. 管理员配置 (Admin Configuration)
- 模态对话框设计
- 选项卡式配置界面
- 包含API、PLC、后台任务、语音四个配置模块
- 实时验证和保存功能

## 主要特性

### 智能化语音交互
- **多唤醒词支持**: 8种唤醒词变体，提高识别准确率
- **防重复触发**: 2秒冷却机制，避免误触发
- **智能打断**: 语音播报中检测到语音输入会等待播放结束后处理
- **错误恢复**: 自动重新连接和状态恢复

### 工业级设备管理
- **PLC标准化**: 支持DB块、地址、数据类型标准化配置
- **批量处理**: 支持点位批量导入、导出、验证和执行
- **连接测试**: 实时测试PLC连接状态
- **配置备份**: JSON格式配置导入导出

### 完善的监控系统
- **实时日志**: PLC执行和后台任务日志实时显示
- **状态监控**: 任务状态、连接状态实时更新
- **错误告警**: 视觉和声音双重错误提示
- **历史记录**: 保留最近50条操作日志

### 用户体验优化
- **响应式设计**: 支持桌面和移动设备
- **视觉反馈**: 操作按钮状态变化和动画效果
- **声音反馈**: 操作成功/失败的语音提示
- **引导提示**: 新用户使用引导和权限引导

## 部署要求

### 浏览器要求
- Chrome 79+ 或 Edge 79+（推荐）
- 支持Web Speech API
- 支持WebRTC API
- 启用JavaScript

### 网络要求
- HTTPS环境（语音识别需要安全上下文）
- 麦克风访问权限
- 后端API服务可达

### 后端服务要求
- RESTful API服务
- 支持CORS跨域
- JSON数据格式
- 标准HTTP状态码

## 使用说明

### 快速开始
1. 打开系统页面，允许麦克风访问权限
2. 说出"小竹小竹"唤醒虚拟助手
3. 说出您的问题，等待AI回答
4. 如需配置系统，点击"系统管理"登录（默认账号: admin，密码: admin123）

### 语音交互
- **唤醒**: "小竹小竹"或类似发音
- **提问**: 唤醒后直接说出问题
- **停止**: 点击停止按钮或等待超时
- **设置**: 通过语音配置相关功能

### PLC管理
1. 进入系统管理 -> PLC配置
2. 配置PLC连接参数（IP、端口、Rack、Slot）
3. 添加和管理点位
4. 测试连接并执行点位操作

### 后台任务
1. 进入系统管理 -> 后台任务
2. 配置读取间隔和PLC参数
3. 选择要读取的点位
4. 启用并启动任务

## 开发指南

### 项目结构
```
video_boy_004.html
├── HTML结构 (单文件架构)
├── CSS样式 (内联样式)
│   ├── 全局样式
│   ├── 面板样式
│   ├── 动画样式
│   └── 响应式样式
├── JavaScript模块
│   ├── Three.js动画系统
│   ├── 语音交互系统
│   ├── PLC管理系统
│   ├── 后台任务系统
│   └── 配置管理系统
└── 外部依赖
    ├── Three.js (0.178.0)
    ├── three-vrm (VRM支持)
    ├── easy-three (简化Three.js)
    ├── Font Awesome (图标)
    └── Google字体
```

### 扩展开发

#### 添加新动画
```javascript
animationController.addAnimation('newAnimation', function({ delta, time }) {
    // 动画逻辑
    this.model.update(delta);
});
```

#### 添加新配置项
1. 在HTML中增加配置表单元素
2. 在`getConfig()`和`saveConfig()`中增加对应字段
3. 在`loadConfigToForm()`中增加加载逻辑

#### 集成新的PLC设备
1. 扩展PLC连接配置参数
2. 修改后端API调用接口
3. 更新点位数据类型支持

## 故障排除

### 常见问题

#### 语音识别不工作
1. 检查浏览器是否支持Web Speech API
2. 确认已授予麦克风访问权限
3. 检查是否在HTTPS环境下
4. 查看控制台错误信息

#### PLC连接失败
1. 检查PLC配置参数是否正确
2. 确认网络可达性
3. 检查后端服务是否正常运行
4. 查看PLC连接日志

#### 动画不显示
1. 检查Three.js是否正确加载
2. 确认VRM模型路径是否正确
3. 查看浏览器控制台错误
4. 检查GPU驱动和WebGL支持

### 调试技巧
- 按F12打开开发者工具
- 查看Console面板的错误信息
- 使用Network面板监控API请求
- 利用Application面板检查LocalStorage

## 性能优化

### 加载优化
- 使用CDN加载外部库
- 懒加载非关键资源
- 压缩和合并静态资源

### 内存管理
- 及时释放不再使用的音频流
- 清理过期的日志记录
- 优化3D模型资源

### 响应优化
- 使用CSS3硬件加速动画
- 减少DOM操作和重绘
- 优化JavaScript执行效率

## 安全建议

### 生产环境
1. 修改默认管理员密码
2. 启用HTTPS
3. 限制跨域访问
4. 定期备份配置

### 数据安全
1. 不要在前端存储敏感信息
2. 验证所有用户输入
3. 使用CSRF令牌保护API
4. 实现API速率限制

## 版本历史

### v1.0.0 (当前版本)
- 完整的语音交互系统
- 3D虚拟形象和动画
- PLC设备管理
- 后台任务调度
- 系统配置管理

### 未来规划
- 多虚拟形象支持
- 高级语音识别引擎
- 移动端App
- 云端配置同步
- 插件系统扩展

## 贡献指南

欢迎提交Issue和Pull Request改进项目。在提交代码前，请确保：

1. 代码符合项目编码规范
2. 通过所有现有测试
3. 更新相关文档
4. 添加适当的注释

## 许可证

本项目基于MIT许可证开源。详细信息请查看LICENSE文件。
